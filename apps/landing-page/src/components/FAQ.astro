---
import { ChevronDown, HelpCircle, Smartphone, Shield, Users } from "lucide-react";

// FAQ data organized by category
const faqCategories = [
  {
    id: "general",
    title: "General",
    icon: "HelpCircle",
    color: "emerald",
    questions: [
      {
        q: "What is Cropia?",
        a: "Cropia is an AI-powered agricultural platform that helps farmers detect crop diseases in real-time using their smartphone camera. It also provides government officials and NGOs with a 'God View' dashboard to monitor regional crop health and prevent outbreaks."
      },
      {
        q: "Is Cropia free to use?",
        a: "Yes! Cropia is completely free for individual farmers. For government organizations and NGOs requiring jurisdiction-level analytics and team management, we offer enterprise plans with dedicated support."
      },
      {
        q: "What languages does Cropia support?",
        a: "Currently, Cropia supports English, Punjabi, and Marathi. We're actively working on adding more regional languages including Hindi, Tamil, Telugu, and Bengali to reach more farmers across India."
      }
    ]
  },
  {
    id: "farmers",
    title: "For Farmers",
    icon: "Smartphone",
    color: "blue",
    questions: [
      {
        q: "Does Cropia work without internet?",
        a: "Absolutely! Cropia is designed with an offline-first approach. You can scan your crops and get instant AI diagnosis even in remote areas with no connectivity. The data automatically syncs when you're back online."
      },
      {
        q: "How accurate is the AI diagnosis?",
        a: "Our AI achieves a 98% accuracy rate across supported crops. Each diagnosis includes a confidence score so you know how reliable the result is. We recommend consulting local agricultural experts for critical decisions."
      },
      {
        q: "What crops does Cropia support?",
        a: "Cropia currently supports major Indian crops including wheat, rice, sugarcane, cotton, maize, potato, tomato, and more. Our AI is continuously trained on new crop varieties and diseases to expand coverage."
      },
      {
        q: "What is the Smart Spray Planner?",
        a: "The Smart Spray Planner analyzes weather conditions (wind speed and rain probability) to recommend the best 12-hour windows for applying pesticides or fertilizers. This ensures maximum effectiveness and reduces waste."
      }
    ]
  },
  {
    id: "admins",
    title: "For Government & NGOs",
    icon: "Users",
    color: "purple",
    questions: [
      {
        q: "How does the 'God View' map work?",
        a: "The God View is an interactive geospatial dashboard that visualizes every crop scan in your jurisdiction. Color-coded markers (green for healthy, red for critical) help you spot disease clusters and potential outbreaks instantly."
      },
      {
        q: "Can I limit access by region?",
        a: "Yes! Cropia features granular Role-Based Access Control (RBAC). You can assign officials to specific States, Districts, or Talukas, ensuring they only see data relevant to their jurisdiction."
      },
      {
        q: "How do outbreak alerts work?",
        a: "Our Regional Analysis Agent continuously monitors scan data and generates automated alerts when disease patterns emerge. You'll receive 'news headlines' like 'Sugarcane Rust cases up 40% in Kolhapur' along with detailed statistical breakdowns."
      }
    ]
  },
  {
    id: "technical",
    title: "Security & Privacy",
    icon: "Shield",
    color: "amber",
    questions: [
      {
        q: "Is my data secure?",
        a: "Yes. All data is encrypted in transit and at rest. Farmer data is stored locally on devices first, and synced securely to the cloud. We follow industry-standard security practices and never share individual farmer data without consent."
      },
      {
        q: "What devices does Cropia work on?",
        a: "Cropia works on any smartphone or tablet with a camera. It's built as a Progressive Web App (PWA), meaning you can install it directly from your browserâ€”no app store required. Works on both Android and iOS."
      },
      {
        q: "Who owns the scan data?",
        a: "Farmers own their individual scan data. Aggregated, anonymized insights may be shared with government partners to help improve regional agricultural policies and early warning systems."
      }
    ]
  }
];

const iconComponents = {
  HelpCircle,
  Smartphone,
  Users,
  Shield
};
---

<section id="faq" class="relative py-24 bg-zinc-900 overflow-hidden">
  <!-- Background Elements -->
  <div class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-emerald-500/5 rounded-full blur-[150px] pointer-events-none"></div>
  <div class="absolute bottom-0 right-1/4 w-[400px] h-[400px] bg-purple-500/5 rounded-full blur-[120px] pointer-events-none"></div>
  
  <!-- Subtle Grid Pattern -->
  <div class="absolute inset-0 opacity-[0.02]" style="background-image: url('data:image/svg+xml,%3Csvg width=&quot;60&quot; height=&quot;60&quot; viewBox=&quot;0 0 60 60&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cg fill=&quot;none&quot; fill-rule=&quot;evenodd&quot;%3E%3Cg fill=&quot;%23ffffff&quot; fill-opacity=&quot;1&quot;%3E%3Cpath d=&quot;M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z&quot;/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
  
  <div class="container mx-auto px-6 md:px-12 relative z-10">
    <!-- Section Header -->
    <div class="text-center max-w-2xl mx-auto mb-16">
      <span class="text-emerald-400 font-bold tracking-widest text-sm uppercase mb-3 block font-brand">
        Have Questions?
      </span>
      <h2 class="text-4xl md:text-5xl font-light text-white mb-6 font-brand tracking-tight">
        Frequently Asked <br />
        <span class="font-semibold text-transparent bg-clip-text bg-gradient-to-r from-emerald-200 to-emerald-500">
          Questions
        </span>
      </h2>
      <p class="text-lg text-gray-400 font-light leading-relaxed">
        Everything you need to know about Cropia. Can't find what you're looking for? 
        <a href="mailto:support@cropia.io" class="text-emerald-400 hover:text-emerald-300 underline underline-offset-2 transition-colors">
          Contact our team
        </a>
      </p>
    </div>

    <!-- Category Tabs (Desktop) -->
    <div class="hidden md:flex justify-center gap-4 mb-12">
      {faqCategories.map((category, index) => {
        const IconComponent = iconComponents[category.icon as keyof typeof iconComponents];
        return (
          <button
            class={`faq-tab group flex items-center gap-2 px-6 py-3 rounded-full 
                   border border-white/10 bg-gray-900/50 backdrop-blur-sm
                   text-gray-400 font-medium text-sm
                   hover:border-${category.color}-500/50 hover:text-white
                   transition-all duration-300
                   ${index === 0 ? 'active border-emerald-500/50 bg-emerald-500/10 text-white' : ''}`}
            data-category={category.id}
          >
            <IconComponent className={`w-4 h-4 transition-colors ${index === 0 ? 'text-emerald-400' : 'text-gray-500 group-hover:text-emerald-400'}`} />
            {category.title}
          </button>
        );
      })}
    </div>

    <!-- FAQ Accordion Container -->
    <div class="max-w-3xl mx-auto faq-container relative">
      {faqCategories.map((category, catIndex) => (
        <div 
          class={`faq-category transition-all duration-300 ${catIndex === 0 ? 'active opacity-100' : 'opacity-0 pointer-events-none absolute inset-0'}`}
          data-category={category.id}
        >
          <!-- Mobile Category Header -->
          <div class="md:hidden mb-6">
            <h3 class={`text-lg font-semibold text-${category.color}-400 flex items-center gap-2`}>
              {(() => {
                const IconComponent = iconComponents[category.icon as keyof typeof iconComponents];
                return <IconComponent className="w-5 h-5" />;
              })()}
              {category.title}
            </h3>
          </div>
          
          <!-- Questions -->
          <div class="space-y-4">
            {category.questions.map((faq, index) => (
              <div 
                class="faq-item group rounded-2xl border border-white/10 bg-gray-900/30 backdrop-blur-sm
                       hover:border-white/20 transition-all duration-300 overflow-hidden"
                data-index={`${category.id}-${index}`}
              >
                <!-- Question Header -->
                <button 
                  class="faq-toggle w-full flex items-center justify-between gap-4 p-6 text-left
                         transition-colors duration-300"
                  aria-expanded="false"
                >
                  <span class="text-white font-medium text-lg leading-snug pr-4">
                    {faq.q}
                  </span>
                  <div class={`flex-shrink-0 w-8 h-8 rounded-full bg-${category.color}-500/10 
                              flex items-center justify-center transition-all duration-300
                              group-hover:bg-${category.color}-500/20`}>
                    <ChevronDown className={`w-5 h-5 text-${category.color}-400 transition-transform duration-300 faq-chevron`} />
                  </div>
                </button>
                
                <!-- Answer Panel -->
                <div class="faq-answer overflow-hidden transition-all duration-300 max-h-0">
                  <div class="px-6 pb-6 pt-0">
                    <p class="text-gray-400 leading-relaxed">
                      {faq.a}
                    </p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>

    <!-- Mobile Category Navigation -->
    <div class="md:hidden mt-8">
      <div class="flex overflow-x-auto gap-3 pb-4 -mx-6 px-6 scrollbar-hide">
        {faqCategories.map((category, index) => {
          const IconComponent = iconComponents[category.icon as keyof typeof iconComponents];
          return (
            <button
              class={`faq-tab-mobile flex-shrink-0 flex items-center gap-2 px-5 py-2.5 rounded-full 
                     border text-sm font-medium whitespace-nowrap
                     transition-all duration-300
                     ${index === 0 
                       ? 'border-emerald-500/50 bg-emerald-500/10 text-white' 
                       : 'border-white/10 bg-gray-900/50 text-gray-400'}`}
              data-category={category.id}
            >
              <IconComponent className="w-4 h-4" />
              {category.title}
            </button>
          );
        })}
      </div>
    </div>
  </div>
</section>

<style>
  /* Hide scrollbar for mobile tabs */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  
  /* Tab active states */
  .faq-tab.active {
    @apply border-emerald-500/50 bg-emerald-500/10 text-white;
  }
  
  .faq-tab.active svg {
    @apply text-emerald-400;
  }
  
  /* FAQ item open state */
  .faq-item.open {
    @apply border-emerald-500/30 bg-gray-900/50;
  }
  
  .faq-item.open .faq-chevron {
    transform: rotate(180deg);
  }
  
  .faq-item.open .faq-answer {
    max-height: 500px;
  }
  
  /* Color variants for Tailwind */
  .text-emerald-400 { color: rgb(52, 211, 153); }
  .text-blue-400 { color: rgb(96, 165, 250); }
  .text-purple-400 { color: rgb(192, 132, 252); }
  .text-amber-400 { color: rgb(251, 191, 36); }
  
  .bg-emerald-500\/10 { background-color: rgb(16, 185, 129, 0.1); }
  .bg-blue-500\/10 { background-color: rgb(59, 130, 246, 0.1); }
  .bg-purple-500\/10 { background-color: rgb(168, 85, 247, 0.1); }
  .bg-amber-500\/10 { background-color: rgb(245, 158, 11, 0.1); }
  
  .bg-emerald-500\/20 { background-color: rgb(16, 185, 129, 0.2); }
  .bg-blue-500\/20 { background-color: rgb(59, 130, 246, 0.2); }
  .bg-purple-500\/20 { background-color: rgb(168, 85, 247, 0.2); }
  .bg-amber-500\/20 { background-color: rgb(245, 158, 11, 0.2); }

  .border-emerald-500\/30 { border-color: rgb(16, 185, 129, 0.3); }
  .border-emerald-500\/50 { border-color: rgb(16, 185, 129, 0.5); }
  
  /* Smooth answer reveal animation */
  .faq-answer {
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
  }
  
  .faq-item.open .faq-answer {
    opacity: 1;
  }
</style>

<script is:inline>
  // Tab switching (Desktop)
  const tabs = document.querySelectorAll('.faq-tab');
  const categories = document.querySelectorAll('.faq-category');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetCategory = tab.dataset.category;
      
      // Update tabs
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // Show target category with smooth transition
      categories.forEach(cat => {
        if (cat.dataset.category === targetCategory) {
          cat.classList.remove('opacity-0', 'pointer-events-none', 'absolute', 'inset-0');
          cat.classList.add('active', 'opacity-100');
        } else {
          cat.classList.add('opacity-0', 'pointer-events-none', 'absolute', 'inset-0');
          cat.classList.remove('active', 'opacity-100');
        }
      });
    });
  });
  
  // Tab switching (Mobile)
  const mobileTabs = document.querySelectorAll('.faq-tab-mobile');
  
  mobileTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetCategory = tab.dataset.category;
      
      // Update mobile tabs
      mobileTabs.forEach(t => {
        t.classList.remove('border-emerald-500/50', 'bg-emerald-500/10', 'text-white');
        t.classList.add('border-white/10', 'bg-gray-900/50', 'text-gray-400');
      });
      tab.classList.remove('border-white/10', 'bg-gray-900/50', 'text-gray-400');
      tab.classList.add('border-emerald-500/50', 'bg-emerald-500/10', 'text-white');
      
      // Show target category with smooth transition
      categories.forEach(cat => {
        if (cat.dataset.category === targetCategory) {
          cat.classList.remove('opacity-0', 'pointer-events-none', 'absolute', 'inset-0');
          cat.classList.add('active', 'opacity-100');
        } else {
          cat.classList.add('opacity-0', 'pointer-events-none', 'absolute', 'inset-0');
          cat.classList.remove('active', 'opacity-100');
        }
      });
    });
  });
  
  // Accordion toggle
  const faqToggles = document.querySelectorAll('.faq-toggle');
  
  faqToggles.forEach(toggle => {
    toggle.addEventListener('click', () => {
      const faqItem = toggle.closest('.faq-item');
      const isOpen = faqItem.classList.contains('open');
      
      // Close all other items in same category
      const category = faqItem.closest('.faq-category');
      category.querySelectorAll('.faq-item.open').forEach(item => {
        if (item !== faqItem) {
          item.classList.remove('open');
          item.querySelector('.faq-toggle').setAttribute('aria-expanded', 'false');
        }
      });
      
      // Toggle current item
      faqItem.classList.toggle('open');
      toggle.setAttribute('aria-expanded', !isOpen);
    });
  });
</script>
